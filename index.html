<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FinLoan System</title>

<style>
body{font-family:Arial;background:#f4f6fb;margin:0}
.header{background:#1d2671;color:#fff;padding:15px;text-align:center;font-weight:bold}
.container{max-width:450px;margin:20px auto;padding:15px}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 5px 15px rgba(0,0,0,0.08)}
input,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:1px solid #ccc}
button{background:#0072ff;color:#fff;border:none;font-weight:bold}
.loan{background:#eef;padding:8px;border-radius:8px;margin:5px 0;font-size:14px}
</style>
</head>
<body>

<div class="header">FinLoan System</div>
<div class="container">

<div id="authBox" class="card">
  <h3>Đăng nhập / Đăng ký</h3>
  <input id="email" placeholder="Email">
  <input id="pass" type="password" placeholder="Mật khẩu">
  <button onclick="register()">Đăng ký</button>
  <button onclick="login()">Đăng nhập</button>
</div>

<div id="userApp" style="display:none">
  <div class="card">
    <h3>Đăng ký khoản vay</h3>
    <input id="money" type="number" placeholder="Số tiền vay">
    <input type="file" id="cccd">
    <button onclick="sendLoan()">Gửi yêu cầu</button>
  </div>

  <div class="card">
    <h3>Lịch sử vay</h3>
    <div id="history"></div>
  </div>
</div>

<div id="adminApp" style="display:none" class="card">
  <h3>ADMIN - Danh sách khoản vay</h3>
  <div id="allLoans"></div>
</div>

</div>

<!-- FIREBASE CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAMVMlleglI5teSX_wnH74MByezCeJAqqU",
  authDomain: "tambeo-b465a.firebaseapp.com",
  projectId: "tambeo-b465a",
  storageBucket: "tambeo-b465a.firebasestorage.app",
  messagingSenderId: "756559820351",
  appId: "1:756559820351:web:a30b3d8f9596ad5c1baa8a"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

const ADMIN_EMAIL = "admin@gmail.com"; // đổi email admin

function register(){
  auth.createUserWithEmailAndPassword(email.value, pass.value)
  .then(()=>alert("Đăng ký thành công"))
  .catch(e=>alert(e.message));
}

function login(){
  auth.signInWithEmailAndPassword(email.value, pass.value)
  .catch(e=>alert(e.message));
}

auth.onAuthStateChanged(user=>{
  if(user){
    authBox.style.display="none";
    userApp.style.display="block";
    loadHistory(user);

    if(user.email===ADMIN_EMAIL){
      adminApp.style.display="block";
      loadAllLoans();
    }
  }
});

function sendLoan(){
  let user = auth.currentUser;
  let file = cccd.files[0];
  if(!file){ alert("Vui lòng chọn ảnh CCCD"); return; }

  let storageRef = storage.ref("cccd/" + Date.now() + file.name);

  storageRef.put(file).then(()=>{
    storageRef.getDownloadURL().then(url=>{
      db.collection("loans").add({
        uid:user.uid,
        email:user.email,
        money:money.value,
        cccd:url,
        time:new Date().toLocaleString()
      }).then(()=>{
        alert("Đã gửi yêu cầu vay!");
        loadHistory(user);
      });
    });
  });
}

function loadHistory(user){
  history.innerHTML="";
  db.collection("loans").where("uid","==",user.uid).get()
  .then(snap=>{
    snap.forEach(doc=>{
      let d=doc.data();
      history.innerHTML+=`<div class="loan">${d.money} VNĐ - ${d.time}</div>`;
    });
  });
}

function loadAllLoans(){
  allLoans.innerHTML="";
  db.collection("loans").get().then(snap=>{
    snap.forEach(doc=>{
      let d=doc.data();
      allLoans.innerHTML+=`<div class="loan">${d.email} vay ${d.money} - <a href="${d.cccd}" target="_blank">Xem CCCD</a></div>`;
    });
  });
}
</script>

</body>
</html>
